<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>UTRA FASHION - Premium Store</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff3f6c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root { --primary: #ff3f6c; --dark: #282c3f; --light: #f5f5f6; }
        body { background:#fff; font-family:'Segoe UI', sans-serif; margin:0; overflow-x: hidden; color: var(--dark); padding-bottom: 70px; }

        /* HEADER */
        .header { background:#fff; padding:10px 20px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .top-bar-mobile { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .logo-section { display:flex; align-items:center; gap:8px; cursor: pointer; }
        .logo-section b { font-size: 18px; color: #000; text-transform: uppercase; letter-spacing: 1px; }

        /* SEARCH BAR */
        .search-container { background: var(--light); padding: 8px 15px; border-radius: 4px; display: flex; align-items: center; margin-top: 10px; border: 1px solid #eee; }
        .search-container input { background: none; border: none; outline: none; width: 100%; font-size: 14px; }
        .search-lens { width: 18px; height: 18px; opacity: 0.6; }

        /* PRODUCT GRID */
        .product-grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:12px; padding:15px; }
        .product-card { background:#fff; position: relative; border-radius: 8px; overflow: hidden; border: 1px solid #f0f0f0; }
        .product-card img { width:100%; height:220px; object-fit:cover; }
        .product-info { padding: 10px; }
        .product-info h3 { font-size: 14px; margin: 5px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* BOTTOM NAV BAR (REAL APP LOOK) */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 12px 0; box-shadow: 0 -2px 15px rgba(0,0,0,0.1); z-index: 2000; border-top: 1px solid #eee; }
        .nav-item { text-align: center; font-size: 10px; font-weight: bold; color: #555; cursor: pointer; flex: 1; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 2px; }

        /* UTILS */
        .out-of-stock-badge { position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; font-size: 12px; font-weight: bold; border-radius: 4px; z-index: 10; }
        .dim-image { opacity: 0.5; }
        .rating-badge { background: #e8f5e9; color: #2e7d32; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        
        /* SIDEBAR & MODALS */
        #profileSidebar { position: fixed; top: 0; right: -100%; width: 85%; height: 100%; background: white; z-index: 4000; transition: 0.4s; padding: 25px; box-shadow: -5px 0 15px rgba(0,0,0,0.1); }
        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3500; }
        .modal { display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%); background:white; padding:25px; border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,0.2); z-index: 3000; width: 80%; }
        #cartCount { background: var(--primary); color: white; padding: 2px 6px; border-radius: 50%; font-size: 10px; position: absolute; top: -5px; right: -5px; }

        @media (min-width: 769px) {
            .bottom-nav { display: none; }
            .product-grid { grid-template-columns: repeat(4, 1fr); padding: 40px 50px; }
            .header { display: flex; align-items: center; justify-content: space-between; }
            .search-container { width: 400px; margin: 0; }
        }
    </style>
</head>

<body>

<div class="header">
    <div class="top-bar-mobile">
        <div class="logo-section" onclick="location.reload()">
            <img src="image.png" alt="Logo" width="30" style="border-radius:50%">
            <b>UTRA FASHION</b>
        </div>
        <div style="display: flex; gap: 15px;">
            <span onclick="window.location.href='wishlist.html'" style="font-size: 20px; position: relative;">‚ù§Ô∏è</span>
            <span onclick="window.location.href='cart.html'" style="font-size: 20px; position: relative;">üõí<span id="cartCount">0</span></span>
        </div>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" onkeyup="searchProducts()" placeholder="Search Premium Styles...">
        <img src="https://cdn-icons-png.flaticon.com/512/149/149852.png" class="search-lens">
    </div>
</div>

<div class="product-grid" id="product-list"></div>

<div class="bottom-nav">
    <div class="nav-item" onclick="filterCategory('ALL')"><i>üè†</i>Home</div>
    <div class="nav-item" onclick="filterCategory('MEN')"><i>üëï</i>Men</div>
    <div class="nav-item" onclick="filterCategory('WOMEN')"><i>üëó</i>Women</div>
    <div class="nav-item" id="loginBtn" onclick="openLogin()"><i>üë§</i>Login</div>
    <div class="nav-item" id="userInfo" style="display:none;" onclick="openProfile()"><i>üë§</i>Profile</div>
</div>

<div class="sidebar-overlay" id="overlay" onclick="closeProfile()"></div>
<div id="profileSidebar">
    <button onclick="closeProfile()" style="float:right; border:none; background:none; font-size:24px;">‚úñ</button>
    <div style="text-align:center; margin-top:30px;"><div id="sideLetter" style="width:70px; height:70px; background:var(--primary); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:bold; margin:0 auto;"></div></div>
    <hr style="margin:25px 0; border:0; border-top:1px solid #eee;">
    <input type="text" id="sideName" placeholder="Full Name" style="width:90%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
    <input type="number" id="sideMobile" placeholder="Mobile Number" style="width:90%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;">
    <textarea id="sideAddress" rows="3" placeholder="Delivery Address" style="width:90%; padding:12px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;"></textarea>
    <button onclick="saveProfile()" style="background:var(--primary); color:white; border:none; padding:15px; width:100%; font-weight:bold; border-radius:4px;">SAVE DETAILS</button>
    <button onclick="window.location.href='my-orders.html'" style="width:100%; background:#000; color:#fff; margin-top:12px; padding:12px; border:none; border-radius:4px;">üì¶ MY ORDERS</button>
    <button onclick="auth.signOut().then(()=>location.reload())" style="margin-top:30px; color:red; background:none; border:none; width:100%; font-weight:bold;">Logout</button>
</div>

<div class="modal" id="loginBox">
    <h3 id="auth-title" style="margin-top:0;">Welcome Back</h3>
    <input type="email" id="email" placeholder="Email Address" style="width:90%; padding:12px; margin-bottom:12px; border:1px solid #ddd; border-radius:4px;">
    <input type="password" id="password" placeholder="Password" style="width:90%; padding:12px; margin-bottom:12px; border:1px solid #ddd; border-radius:4px;">
    <button id="auth-btn" onclick="handleAuth()" style="width:100%; background:var(--primary); color:white; border:none; padding:15px; font-weight:bold; border-radius:4px;">CONTINUE</button>
    <p id="toggle-text" style="font-size:13px; text-align:center; color:#666; margin-top:20px;">New User? <span style="color:var(--primary); font-weight:bold; cursor:pointer;" onclick="toggleAuth()">Create Account</span></p>
    <button onclick="closeLogin()" style="width:100%; background:none; border:none; margin-top:10px; color:#888;">Maybe Later</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig={ apiKey:"AIzaSyCax6078YpxQU0kHIChQLuEmpLUYXSxQr4", authDomain:"e-commerce-wepsite.firebaseapp.com", projectId:"e-commerce-wepsite", storageBucket:"e-commerce-wepsite.appspot.com", messagingSenderId:"394408704286", appId:"1:394408704286:web:9ad690a946b225ab20f10f" };
    firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();
    const auth=firebase.auth();

    let allProducts = []; 
    let isLoginMode = true;

    db.collection("products").orderBy("createdAt","desc").onSnapshot(snapshot=>{
        allProducts = [];
        snapshot.forEach(docSnap => { allProducts.push({ id: docSnap.id, ...docSnap.data() }); });
        renderProducts(allProducts);
    });

    function renderProducts(products) {
        const list = document.getElementById("product-list");
        list.innerHTML = "";
        products.forEach(data => {
            const isInStock = data.inStock !== false;
            list.innerHTML += `
            <div class="product-card">
                ${!isInStock ? '<div class="out-of-stock-badge">OUT OF STOCK</div>' : ''}
                <img src="${data.imageUrl}" class="${!isInStock ? 'dim-image' : ''}" onclick="window.location.href='product-details.html?id=${data.id}'">
                <div class="product-info">
                    <div id="rate-${data.id}" class="rating-badge">‚≠ê ...</div>
                    <h3>${data.productName}</h3>
                    <p style="font-weight:bold; color:var(--primary); margin: 5px 0;">‚Çπ${data.price}</p>
                </div>
            </div>`;
            
            db.collection("reviews").where("productName", "==", data.productName).get().then(snap => {
                let total = 0; snap.forEach(r => total += r.data().rating);
                let avg = snap.size > 0 ? (total / snap.size).toFixed(1) : "0.0";
                const rateEl = document.getElementById(`rate-${data.id}`);
                if(rateEl) rateEl.innerText = `‚≠ê ${avg} (${snap.size})`;
            });
        });
    }

    window.filterCategory = function(cat) {
        if(cat === 'ALL') renderProducts(allProducts);
        else renderProducts(allProducts.filter(p => p.category === cat));
    }

    window.searchProducts = function() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        renderProducts(allProducts.filter(p => p.productName.toLowerCase().includes(term)));
    }

    auth.onAuthStateChanged(user=>{
        const loginBtn=document.getElementById("loginBtn");
        const userInfo=document.getElementById("userInfo");
        const count = JSON.parse(localStorage.getItem("cart"))?.length || 0;
        document.getElementById("cartCount").innerText = count;

        if(user && user.email !== "sureshrajagunam24@gmail.com"){
            loginBtn.style.display="none"; userInfo.style.display="block";
            document.getElementById("userLetter").innerText = user.email.charAt(0).toUpperCase();
        } else {
            loginBtn.style.display="block"; userInfo.style.display="none";
        }
    });

    function openProfile() {
        document.getElementById("profileSidebar").style.right = "0";
        document.getElementById("overlay").style.display = "block";
        const user = auth.currentUser;
        document.getElementById("sideLetter").innerText = user.email.charAt(0).toUpperCase();
        db.collection("users").doc(user.uid).get().then(doc => {
            if(doc.exists) {
                document.getElementById("sideName").value = doc.data().name || "";
                document.getElementById("sideMobile").value = doc.data().mobile || "";
                document.getElementById("sideAddress").value = doc.data().address || "";
            }
        });
    }
    function closeProfile() { document.getElementById("profileSidebar").style.right = "-100%"; document.getElementById("overlay").style.display = "none"; }
    function saveProfile() {
        const user = auth.currentUser;
        const name = document.getElementById("sideName").value;
        const mobile = document.getElementById("sideMobile").value;
        const address = document.getElementById("sideAddress").value;
        db.collection("users").doc(user.uid).set({name, mobile, address, email:user.email}, {merge:true}).then(() => alert("Saved ‚úÖ"));
    }
    function openLogin() { document.getElementById("loginBox").style.display="block"; }
    function closeLogin() { document.getElementById("loginBox").style.display="none"; }
    function toggleAuth() {
        isLoginMode = !isLoginMode;
        document.getElementById("auth-title").innerText = isLoginMode ? "Welcome Back" : "Create Account";
        document.getElementById("auth-btn").innerText = isLoginMode ? "CONTINUE" : "REGISTER";
    }
    function handleAuth() {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        if (!email || !password) { alert("Fill all fields!"); return; }
        if (isLoginMode) auth.signInWithEmailAndPassword(email, password).then(() => location.reload()).catch(err => alert(err.message));
        else auth.createUserWithEmailAndPassword(email, password).then(() => { alert("Account Created! ‚úÖ"); location.reload(); }).catch(err => alert(err.message));
    }
</script>
</body>
</html>
