<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Loyal Fashion</title>
<style>
body{margin:0;font-family:Segoe UI;display:flex;height:100vh;background:#f4f6f9;}
.sidebar{width:260px;background:#000;color:white;display:flex;flex-direction:column;padding:20px;}
.logo{text-align:center;margin-bottom:40px;}
.logo img{width:60px;border-radius:50%;}
.logo h2{margin-top:10px;letter-spacing:2px;}
.nav-item{padding:15px;margin-bottom:10px;border-radius:8px;cursor:pointer;transition:0.3s;}
.nav-item:hover{background:#222;color:#ffd700;}
.nav-item.active{background:#222;color:#ffd700;}
.logout{margin-top:auto;background:#ff4d4d;text-align:center;cursor:pointer;}
.main{flex:1;padding:40px;overflow:auto;}
.card{background:white;padding:25px;border-radius:15px;box-shadow:0 8px 20px rgba(0,0,0,0.05);margin-bottom:30px;}
input{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:1px solid #ddd;}
button{padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
.post-btn{width:100%;background:#007bff;color:white;margin-bottom:10px;}
table{width:100%;border-collapse:collapse;}
th,td{padding:12px;border-bottom:1px solid #eee;text-align:left;}
img.product-img{width:50px;height:50px;border-radius:8px;}
.edit-btn{background:#ffc107;color:#000;padding:5px 10px;margin-right:5px;border-radius:5px;cursor:pointer;}
.delete-btn{background:#dc3545;color:white;padding:5px 10px;border-radius:5px;cursor:pointer;}
</style>
</head>
<body>

<div class="sidebar">
    <div class="logo"><img src="image.png" alt="Logo"><h2>LOYAL FASHION</h2></div>
    <div class="nav-item active" onclick="showTab('dashboard')">ðŸ“Š Dashboard</div>
    <div class="nav-item" onclick="showTab('addProduct')">âž• Add Product</div>
    <div class="nav-item" onclick="showTab('inventory')">ðŸ“¦ Inventory</div>
    <div class="nav-item logout" onclick="logout()">ðŸšª Logout</div>
</div>

<div class="main">

  <!-- Dashboard summary -->
  <div id="dashboard" class="tab-card">
      <h1>Dashboard Summary</h1>
      <div class="card">
        <p>Total Products: <span id="total-products">0</span></p>
        <p>Total Value: â‚¹<span id="total-value">0</span></p>
      </div>
      <div class="card">
        <h3>Recent Products</h3>
        <table>
          <thead>
            <tr><th>Name</th><th>Price</th></tr>
          </thead>
          <tbody id="recent-products"></tbody>
        </table>
      </div>
  </div>

  <!-- Add Product tab -->
  <div id="addProduct" class="tab-card" style="display:none;">
      <h1>Add New Product</h1>
      <div class="card">
          <input type="text" id="pName" placeholder="Product Name">
          <input type="number" id="pPrice" placeholder="Price (â‚¹)">
          <input type="file" id="pImage" accept="image/*">
          <button class="post-btn" onclick="saveProduct()">Upload / Update Product</button>
          <p id="status"></p>
      </div>
      <!-- Inventory below form -->
      <div class="card">
        <h3>Inventory</h3>
        <table>
          <thead>
            <tr><th>Image</th><th>Name</th><th>Price</th><th>Action</th></tr>
          </thead>
          <tbody id="product-table"></tbody>
        </table>
      </div>
  </div>

  <!-- Inventory tab (optional separate view) -->
  <div id="inventory" class="tab-card" style="display:none;">
      <h1>Inventory</h1>
      <div class="card">
        <table>
          <thead>
            <tr><th>Image</th><th>Name</th><th>Price</th><th>Action</th></tr>
          </thead>
          <tbody id="inventory-table"></tbody>
        </table>
      </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCax6078YpxQU0kHIChQLuEmpLUYXSxQr4",
  authDomain: "e-commerce-wepsite.firebaseapp.com",
  projectId: "e-commerce-wepsite",
  storageBucket: "e-commerce-wepsite.appspot.com",
  messagingSenderId: "394408704286",
  appId: "1:394408704286:web:9ad690a946b225ab20f10f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let editId = null;

/* AUTH CHECK */
onAuthStateChanged(auth, (user)=>{
    if(!user || user.email.toLowerCase()!=="sureshrajagunam24@gmail.com"){
        window.location.href="admin-login.html";
    } else {
        loadProducts();
        loadInventory();
        updateDashboardSummary();
    }
});

/* LOGOUT */
window.logout = async function(){ try{ await signOut(auth); window.location.href="admin-login.html"; }catch(err){console.error(err);}}

/* Tabs */
function showTab(tab){
    document.querySelectorAll('.tab-card').forEach(div=>div.style.display='none');
    document.getElementById(tab).style.display='block';
    document.querySelectorAll('.nav-item').forEach(nav=>nav.classList.remove('active'));
    event.target.classList.add('active');
}

/* SAVE / UPDATE PRODUCT */
window.saveProduct = async function(){
    const name = document.getElementById("pName").value.trim();
    const price = document.getElementById("pPrice").value.trim();
    const file = document.getElementById("pImage").files[0];
    const status = document.getElementById("status");

    if(!name || !price || (!file && !editId)){ status.innerText="Fill all fields âŒ"; return; }

    let imageUrl = null;

    if(file){
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = async ()=>{
            imageUrl = reader.result;
            await saveToFirebase(name, price, imageUrl);
        };
    } else {
        await saveToFirebase(name, price, null);
    }
};

async function saveToFirebase(name, price, imageUrl){
    if(editId){
        const docRef = doc(db,"products",editId);
        let updateData = {productName:name, price:Number(price)};
        if(imageUrl) updateData.imageUrl=imageUrl;
        await updateDoc(docRef, updateData);
        editId = null;
        document.getElementById("status").innerText="Product updated âœ…";
    } else {
        await addDoc(collection(db,"products"), {productName:name, price:Number(price), imageUrl:imageUrl, createdAt:serverTimestamp()});
        document.getElementById("status").innerText="Product uploaded âœ…";
    }
    document.getElementById("pName").value="";
    document.getElementById("pPrice").value="";
    document.getElementById("pImage").value="";
}

/* LOAD PRODUCTS INTO TABLE */
function loadProducts(){
    const q = collection(db,"products");
    onSnapshot(q,(snapshot)=>{
        const table = document.getElementById("product-table");
        table.innerHTML="";
        snapshot.forEach(docSnap=>{
            const data = docSnap.data();
            const id = docSnap.id;
            table.innerHTML += `
            <tr>
                <td><img src="${data.imageUrl}" class="product-img"></td>
                <td>${data.productName}</td>
                <td>â‚¹${data.price}</td>
                <td>
                    <button class="edit-btn" onclick="editProduct('${id}','${data.productName}','${data.price}')">Edit</button>
                    <button class="delete-btn" onclick="deleteProduct('${id}')">Delete</button>
                </td>
            </tr>`;
        });
    });
}

/* LOAD INVENTORY TAB */
function loadInventory(){
    const q = collection(db,"products");
    onSnapshot(q,(snapshot)=>{
        const table = document.getElementById("inventory-table");
        table.innerHTML="";
        snapshot.forEach(docSnap=>{
            const data = docSnap.data();
            const id = docSnap.id;
            table.innerHTML += `
            <tr>
                <td><img src="${data.imageUrl}" class="product-img"></td>
                <td>${data.productName}</td>
                <td>â‚¹${data.price}</td>
                <td>
                    <button class="edit-btn" onclick="editProduct('${id}','${data.productName}','${data.price}')">Edit</button>
                    <button class="delete-btn" onclick="deleteProduct('${id}')">Delete</button>
                </td>
            </tr>`;
        });
    });
}

/* EDIT PRODUCT */
window.editProduct = function(id,name,price){
    document.getElementById("pName").value=name;
    document.getElementById("pPrice").value=price;
    editId=id;
    showTab('addProduct');
}

/* DELETE PRODUCT */
window.deleteProduct = async function(id){
    if(confirm("Are you sure to delete this product?")){
        await deleteDoc(doc(db,"products",id));
        updateDashboardSummary();
    }
}

/* DASHBOARD SUMMARY */
function updateDashboardSummary(){
    const q = collection(db,"products");
    onSnapshot(q,(snapshot)=>{
        const totalProducts = snapshot.size;
        let totalValue = 0;
        const recentProductsEl = document.getElementById("recent-products");
        recentProductsEl.innerHTML="";
        snapshot.forEach(docSnap=>{
            const data = docSnap.data();
            totalValue += Number(data.price);
        });
        const recent = snapshot.docs.slice(-3).reverse();
        recent.forEach(docSnap=>{
            const data = docSnap.data();
            recentProductsEl.innerHTML += `<tr><td>${data.productName}</td><td>â‚¹${data.price}</td></tr>`;
        });
        document.getElementById("total-products").innerText=totalProducts;
        document.getElementById("total-value").innerText=totalValue;
    });
}
</script>

</body>
</html>
